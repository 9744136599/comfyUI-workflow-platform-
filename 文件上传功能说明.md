# 文件上传功能说明

## 功能概述

在创作页面右侧添加了PNG文件上传功能，支持将PNG文件转换为二进制格式并上传到ComfyUI。

## 功能特点

1. **拖拽上传**: 支持拖拽PNG文件到上传区域
2. **点击上传**: 点击上传区域选择PNG文件
3. **文件验证**: 自动验证文件格式（仅支持PNG）和大小（最大10MB）
4. **二进制转换**: 将PNG文件转换为二进制字符串格式
5. **ComfyUI集成**: 调用ComfyUI的`/upload/image`接口
6. **状态反馈**: 显示上传进度和结果状态

## 技术实现

### 前端实现

1. **文件选择**: 使用HTML5的`<input type="file">`元素
2. **二进制转换**: 
   ```javascript
   const arrayBuffer = await file.arrayBuffer()
   const binaryString = String.fromCharCode.apply(null, new Uint8Array(arrayBuffer))
   ```
3. **API调用**: 使用`fetch`发送POST请求到`/api/upload/image`

### 后端实现

1. **路由**: `/api/upload/image` (POST)
2. **控制器**: `uploadController.js`
3. **文件处理**: 将二进制字符串转换回Buffer并保存到服务器
4. **响应格式**: 返回ComfyUI期望的格式
   ```json
   {
     "name": "timestamp-randomId.png",
     "subfolder": "",
     "type": "input"
   }
   ```

## 使用方法

### 在创作页面使用

1. 打开创作页面 (`/create`)
2. 在右侧找到"请在此处上传文件"区域
3. 点击或拖拽PNG文件到上传区域
4. 点击"上传到ComfyUI"按钮
5. 等待上传完成，查看返回的文件名

### 测试页面

访问 `/test-upload` 页面可以单独测试上传功能。

## API接口

### POST /api/upload/image

**请求格式:**
```json
{
  "image": "string(binary)"
}
```

**响应格式:**
```json
{
  "name": "1750640879022-32be6192.png",
  "subfolder": "",
  "type": "input"
}
```

## 文件存储

上传的文件保存在 `rearend/public/uploads/temp/` 目录下，文件名格式为 `timestamp-randomId.png`。

## 变量说明

- `select`: 保存ComfyUI返回的文件名，可用于后续的图片编辑功能
- `uploadedFile`: 保存上传文件的信息（名称、大小、预览等）
- `uploadStatus`: 保存上传状态（成功/失败、消息等）

## 注意事项

1. 仅支持PNG格式文件
2. 文件大小限制为10MB
3. 上传的文件会保存在服务器的临时目录中
4. 返回的文件名可以用于ComfyUI工作流中的图片引用

## 扩展功能

这个上传功能为后续的图片编辑（img2img）功能奠定了基础，可以：

1. 将上传的图片作为输入图片
2. 结合文字提示词进行图片修改
3. 使用ComfyUI的img2img工作流
4. 实现基于图片的AI创作功能 